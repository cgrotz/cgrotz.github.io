{"componentChunkName":"component---src-templates-blog-post-js","path":"/2021-03-14-covid-data-with-dataflow-and-bigquery/","result":{"data":{"site":{"siteMetadata":{"title":"Christoph's Blog about Digital Stuff"}},"markdownRemark":{"id":"54338f72-b571-55e2-ab0e-e531034adfbf","excerpt":"This weekend, I asked myself a simple question. Do the Covid  Vaccinations in Germany, have an impact on the number of deceased cases we are seeing in the data…","html":"<p>This weekend, I asked myself a simple question. Do the Covid  Vaccinations in Germany, have an impact on the number of deceased cases we are seeing in the data? A positive signal in the data, would be for me as a light at the end of the tunnel.</p>\n<p>So I headed over to BigQuery and took a look at the public available Covid 19 Dataset. The dataset is the data available from JHU. It contains the number of confirmed, tested and deceased cases by date and country. Which is ideal for my use cases. With a simple query, we can bring that data onto a chart in Google Data Studio.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>\n  <span class=\"token keyword\">date</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>cumulative_deceased<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> Deceased<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>cumulative_confirmed<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> Confirmed\n  <span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">`</span>bigquery<span class=\"token operator\">-</span><span class=\"token keyword\">public</span><span class=\"token operator\">-</span><span class=\"token keyword\">data</span><span class=\"token punctuation\">.</span>covid19_open_data<span class=\"token punctuation\">.</span>covid19_open_data<span class=\"token punctuation\">`</span>\n  <span class=\"token keyword\">WHERE</span> country_code <span class=\"token operator\">=</span> <span class=\"token string\">'DE'</span> <span class=\"token operator\">AND</span> subregion1_code <span class=\"token operator\">is</span> <span class=\"token boolean\">null</span>\n  <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">date</span>\n  <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">date</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0a773056fcc23a87eada400663210759/081ff/simple_query.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0UlEQVQoz3WQ0ZbCIAxE+f8fdd2zigvUAkkYIVBse/ThdpKQhCkmZYYLK5z3eGaCffwjE0MKwPXzCSnfMSEsiCkhVTKRKjOhiECEq54RvfATiQTGOQfh2likDxQZh50lMvzKCBvxxEozfiaG8fVXYyIdnAO7pvYkZyd753JQdeirA1I32wDzu0nhTqu3nPkN7WJuC5tDObyZjAVDR31beshFDjocOsScx5t1p1H1zFbnr7UWm7AsuPzdcL1b/NzuytVazX/tQ3WeDZ21qX3O1l0vJ2NyZTSJEaMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"simple query\"\n        title=\"simple query\"\n        src=\"/static/0a773056fcc23a87eada400663210759/fcda8/simple_query.png\"\n        srcset=\"/static/0a773056fcc23a87eada400663210759/12f09/simple_query.png 148w,\n/static/0a773056fcc23a87eada400663210759/e4a3f/simple_query.png 295w,\n/static/0a773056fcc23a87eada400663210759/fcda8/simple_query.png 590w,\n/static/0a773056fcc23a87eada400663210759/efc66/simple_query.png 885w,\n/static/0a773056fcc23a87eada400663210759/c83ae/simple_query.png 1180w,\n/static/0a773056fcc23a87eada400663210759/081ff/simple_query.png 2182w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>But how about the number of vaccinations? They aren’t included in the JHU data set as of now. The German government is providing the vaccination data on their Open Data platform GovData [link to data]. The data can is available in different formats (CSV, XLS, JSON). <a href=\"https://www.govdata.de/web/guest/suchen/-/details/deutschland-corona-impfungen\">GovData Corona Vaccinations Dataset</a></p>\n<p>So I decided to write a simple Google Dataflow job to ingest that data into  BigQuery. Of course, the amount of data doesn’t need Dataflow or BigQuery, but for me, it was a good exercise in using both. And I like the query capabilities of BigQuery a lot. </p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">.</span>bigquery<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>TableFieldSchema\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">.</span>bigquery<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>TableRow\n<span class=\"token keyword\">import</span> com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">.</span>bigquery<span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span>TableSchema\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>Pipeline\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>TextIO\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span>gcp<span class=\"token punctuation\">.</span>bigquery<span class=\"token punctuation\">.</span>BigQueryIO\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>PipelineOptions\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>PipelineOptionsFactory\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>ValueProvider\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>Filter\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>MapElements\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>SimpleFunction\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>beam<span class=\"token punctuation\">.</span>sdk<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">.</span>TypeDescriptor\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>\n\n<span class=\"token comment\">// https://opendata.rhein-kreis-neuss.de/explore/dataset/deutschland-corona-impfungen/download/?format=csv</span>\n\n<span class=\"token keyword\">class</span> CsvLineFormat <span class=\"token operator\">:</span> SimpleFunction<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>line<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> lineElements <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">arrayOf</span><span class=\"token punctuation\">(</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">11</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">12</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">13</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">14</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">15</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">17</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">19</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">21</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">22</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>lineElements<span class=\"token punctuation\">[</span><span class=\"token number\">23</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> Convert <span class=\"token operator\">:</span> SimpleFunction<span class=\"token operator\">&lt;</span>Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> TableRow<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>line<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> TableRow <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> row <span class=\"token operator\">=</span> <span class=\"token function\">TableRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"date\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_kumulativ\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_differenz_zum_vortag\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_erst_differenz_zum_vortag\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_zweit_differenz_zum_vortag\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_biontech_kumulativ\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_moderna_kumulativ\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_astrazeneca_kumulativ\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"personen_erst_kumulativ\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"personen_voll_kumulativ\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"impf_quote_erst\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toFloat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"impf_quote_voll\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">11</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toFloat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_alter_dosen\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">12</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_beruf_dosen\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">13</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_medizinisch_dosen\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">14</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_pflegeheim_dosen\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">15</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_alter_erst\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_beruf_erst\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">17</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_medizinisch_erst\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_pflegeheim_erst\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">19</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_alter_voll\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_beruf_voll\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">21</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_medizinisch_voll\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">22</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_pflegeheim_voll\"</span><span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">[</span><span class=\"token number\">23</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">toInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">return</span> row\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> RemoveHeaderFilter <span class=\"token operator\">:</span> SimpleFunction<span class=\"token operator\">&lt;</span>Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> Boolean<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>it<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Boolean <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> it<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token string\">\"date\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">inline</span> <span class=\"token keyword\">fun</span> <span class=\"token operator\">&lt;</span><span class=\"token keyword\">reified</span> T<span class=\"token operator\">:</span> Any<span class=\"token operator\">></span> <span class=\"token function\">clazz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>TypeDescriptor<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> TypeDescriptor<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>T<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span>args<span class=\"token operator\">:</span> Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">val</span> options <span class=\"token operator\">=</span> PipelineOptionsFactory\n      <span class=\"token punctuation\">.</span><span class=\"token function\">fromArgs</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">withValidation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span>`<span class=\"token keyword\">as</span>`<span class=\"token punctuation\">(</span>PipelineOptions<span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">val</span> p<span class=\"token operator\">:</span> Pipeline <span class=\"token operator\">=</span> Pipeline<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">var</span> project <span class=\"token operator\">=</span> <span class=\"token string\">\"&lt;project_id>  \"</span>\n  <span class=\"token keyword\">var</span> dataset <span class=\"token operator\">=</span> <span class=\"token string\">\"covid_vaccination_germany\"</span>\n  <span class=\"token keyword\">var</span> table <span class=\"token operator\">=</span> <span class=\"token string\">\"vaccinations\"</span>\n  <span class=\"token keyword\">var</span> schema <span class=\"token operator\">=</span> <span class=\"token function\">TableSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">setFields</span><span class=\"token punctuation\">(</span>\n          Arrays<span class=\"token punctuation\">.</span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DATETIME\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_kumulativ\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_differenz_zum_vortag\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_erst_differenz_zum_vortag\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_zweit_differenz_zum_vortag\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_biontech_kumulativ\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_moderna_kumulativ\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dosen_astrazeneca_kumulativ\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"personen_erst_kumulativ\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"personen_voll_kumulativ\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"impf_quote_erst\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"FLOAT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"impf_quote_voll\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"FLOAT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_alter_dosen\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_beruf_dosen\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_medizinisch_dosen\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_pflegeheim_dosen\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_alter_erst\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_beruf_erst\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_medizinisch_erst\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_pflegeheim_erst\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_alter_voll\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_beruf_voll\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_medizinisch_voll\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token function\">TableFieldSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"indikation_pflegeheim_voll\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INT64\"</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">.</span><span class=\"token function\">setMode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"REQUIRED\"</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span>\n\n  p<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>TextIO<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gs://&lt;project_id>  -bucket/input.csv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Split CSV\"</span><span class=\"token punctuation\">,</span> MapElements\n      <span class=\"token punctuation\">.</span><span class=\"token function\">into</span><span class=\"token punctuation\">(</span>TypeDescriptor<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>Array<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">via</span><span class=\"token punctuation\">(</span> <span class=\"token function\">CsvLineFormat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Filter Header\"</span><span class=\"token punctuation\">,</span> Filter<span class=\"token punctuation\">.</span><span class=\"token function\">by</span><span class=\"token punctuation\">(</span> <span class=\"token function\">RemoveHeaderFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Convert Elements\"</span><span class=\"token punctuation\">,</span> MapElements\n      <span class=\"token punctuation\">.</span><span class=\"token function\">into</span><span class=\"token punctuation\">(</span>clazz<span class=\"token operator\">&lt;</span>TableRow<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">via</span><span class=\"token punctuation\">(</span> <span class=\"token function\">Convert</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Write to BigQuery\"</span><span class=\"token punctuation\">,</span> BigQueryIO<span class=\"token punctuation\">.</span><span class=\"token function\">writeTableRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s:%s.%s\"</span><span class=\"token punctuation\">,</span> project<span class=\"token punctuation\">,</span> dataset<span class=\"token punctuation\">,</span> table<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withSchema</span><span class=\"token punctuation\">(</span>schema<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withCustomGcsTempLocation</span><span class=\"token punctuation\">(</span>ValueProvider<span class=\"token punctuation\">.</span>StaticValueProvider<span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gs://&lt;temp_bucket_id>/bigquerytemp\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withCreateDisposition</span><span class=\"token punctuation\">(</span>BigQueryIO<span class=\"token punctuation\">.</span>Write<span class=\"token punctuation\">.</span>CreateDisposition<span class=\"token punctuation\">.</span>CREATE_IF_NEEDED<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withWriteDisposition</span><span class=\"token punctuation\">(</span>BigQueryIO<span class=\"token punctuation\">.</span>Write<span class=\"token punctuation\">.</span>WriteDisposition<span class=\"token punctuation\">.</span>WRITE_TRUNCATE<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n  p<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">waitUntilFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Cloud Schedule triggers the job for us on a daily schedule. Cloud Schedule also downloads the latest CSV from GovData to our Cloud Storage, by triggering a Cloud Function for us.</p>\n<p>This allows us to combine the two data sets in a single query. Which is pretty awesome, if you think about it. I own only one of the datasets but can use them both in my analysis.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>\n  CAST<span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span><span class=\"token keyword\">date</span> <span class=\"token keyword\">AS</span> <span class=\"token keyword\">DATE</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> <span class=\"token keyword\">Date</span><span class=\"token punctuation\">,</span>\n  v<span class=\"token punctuation\">.</span>personen_erst_kumulativ <span class=\"token keyword\">AS</span> First_Injection<span class=\"token punctuation\">,</span>\n  v<span class=\"token punctuation\">.</span>personen_voll_kumulativ <span class=\"token keyword\">AS</span> Completely_Vaccinated<span class=\"token punctuation\">,</span>\n  c<span class=\"token punctuation\">.</span>Confirmed<span class=\"token punctuation\">,</span>\n  c<span class=\"token punctuation\">.</span>Deceased\n<span class=\"token keyword\">FROM</span>\n  <span class=\"token punctuation\">`</span><span class=\"token operator\">&lt;</span>project_id<span class=\"token operator\">></span>  <span class=\"token punctuation\">.</span>covid_vaccination_germany<span class=\"token punctuation\">.</span>vaccinations<span class=\"token punctuation\">`</span> <span class=\"token keyword\">AS</span> v\n<span class=\"token keyword\">INNER</span> <span class=\"token keyword\">JOIN</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">SELECT</span>\n  <span class=\"token keyword\">date</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>cumulative_deceased<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> Deceased<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>cumulative_confirmed<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> Confirmed\n  <span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">`</span>bigquery<span class=\"token operator\">-</span><span class=\"token keyword\">public</span><span class=\"token operator\">-</span><span class=\"token keyword\">data</span><span class=\"token punctuation\">.</span>covid19_open_data<span class=\"token punctuation\">.</span>covid19_open_data<span class=\"token punctuation\">`</span>\n  <span class=\"token keyword\">WHERE</span> country_code <span class=\"token operator\">=</span> <span class=\"token string\">'DE'</span> <span class=\"token operator\">AND</span> subregion1_code <span class=\"token operator\">is</span> <span class=\"token boolean\">null</span>\n  <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">date</span>\n  <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> <span class=\"token keyword\">date</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> c\n<span class=\"token keyword\">ON</span>\n  CAST<span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">.</span><span class=\"token keyword\">date</span> <span class=\"token keyword\">AS</span> <span class=\"token keyword\">DATE</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span><span class=\"token keyword\">date</span>\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span>\n  v<span class=\"token punctuation\">.</span><span class=\"token keyword\">date</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ff6c406af251e9c7f3bddcad041742c0/081ff/full_query.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABK0lEQVQoz2WSjXKEIAyEff/n7Kj1/KsgJkDcLhw3vbbOfBMIJCRZu5gyfLjgvYOkhK/jQJYEfzjsXzsO2hylnh/OoXz3ff+n+Tt/nlCNRBGZUFSQaVUUIlL9da9tnfNvzJ7w0RwOdI6vGg+Mzpd9XbJG3ee2/psoRaSLXVy+PlwTvi6ZvZHfeEtudtOXYKzIxBMWlBTGpu02ttwqLAk1NpL92IKW9hUhBJQCKhyVO5UkOJ9w7lrpytC9UBgxnNqQSKEEp/dPGBxoE8VLgbN2iuTZarUNFpBJF3hZGCxXGerJQ6ocGHw6RPoqDFAGq29UESlUEYvjUXYXS4ccRVd+j/mjx9yPmPoJ62PH43PDPG0Y+xnjQB4LBjKuK8aN/mV9rskwL3U/LAumbcc3qChvr3uUfasAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"full query\"\n        title=\"full query\"\n        src=\"/static/ff6c406af251e9c7f3bddcad041742c0/fcda8/full_query.png\"\n        srcset=\"/static/ff6c406af251e9c7f3bddcad041742c0/12f09/full_query.png 148w,\n/static/ff6c406af251e9c7f3bddcad041742c0/e4a3f/full_query.png 295w,\n/static/ff6c406af251e9c7f3bddcad041742c0/fcda8/full_query.png 590w,\n/static/ff6c406af251e9c7f3bddcad041742c0/efc66/full_query.png 885w,\n/static/ff6c406af251e9c7f3bddcad041742c0/c83ae/full_query.png 1180w,\n/static/ff6c406af251e9c7f3bddcad041742c0/081ff/full_query.png 2182w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"Analyzing Covid Data with Dataflow and BigQuery","date":"2021-03-14 12:10:00 +0200","description":"Monitoring Covid confirmed cases and deceased compared to vaccination"}}},"pageContext":{"slug":"/2021-03-14-covid-data-with-dataflow-and-bigquery/","previous":{"fields":{"slug":"/2020-09-01-esp32_ci_cd_part6/"},"frontmatter":{"title":"Processing the Firmware Installation"}},"next":{"fields":{"slug":"/2021-03-20-kotlin-conditional-assignments/"},"frontmatter":{"title":"Assigning values in Kotlin with a condition"}}}},"staticQueryHashes":["1246554614","2841359383"]}