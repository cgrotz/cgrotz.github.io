{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-08-26-esp32_ci_cd_part4/","result":{"data":{"site":{"siteMetadata":{"title":"Christoph's Blog about Digital Stuff"}},"markdownRemark":{"id":"f6a7f9b0-13b0-5c7e-8c7e-e088fec77399","excerpt":"This is the fourth part of a multi-part blog post. You might want to start from the beginning with the first post. Welcome back, in this part of the series weâ€¦","html":"<p>This is the fourth part of a multi-part blog post. You might want to start from the beginning with the <a href=\"/2020-08-23-esp32_ci_cd_part1\">first post</a>.</p>\n<p>Welcome back, in this part of the series we are going to connect our firmware build to Bosch IoT Rollouts. We need to add several new build steps to our GitHub Actions yaml (if you followed the example in <a href=\"/2020-08-24-esp32_ci_cd_part2\">Part 2</a> it should be placed under <em>.github/workflows/ci.yml</em>). You can find the complete example at the end of the post.</p>\n<p>We are going to use the short form of the the GIT commit hash as version identifier for the continuous build.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Extract git commit id\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> vars\n      <span class=\"token key atrule\">shell</span><span class=\"token punctuation\">:</span> bash\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        echo \"##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})\"\n        echo \"::set-output name=sha_short::$(git rev-parse --short HEAD)\"</span></code></pre></div>\n<p><em>Extracting the GIT metadata. Thanks to aborilov for this piece of code from Stack overflow <a href=\"https://stackoverflow.com/a/58035262\">link</a></em></p>\n<p>We need to create a Software Module, to which we then can upload the artifact.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_sm\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Create Software Module\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cgrotz/hawkbit<span class=\"token punctuation\">-</span>create<span class=\"token punctuation\">-</span>software<span class=\"token punctuation\">-</span>module<span class=\"token punctuation\">-</span>action@v4\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">hawkbit-tenant</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_TENANT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">software-module-name</span><span class=\"token punctuation\">:</span> Beta Firmware\n        <span class=\"token key atrule\">software-module-type</span><span class=\"token punctuation\">:</span> Application\n        <span class=\"token key atrule\">software-module-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.vars.outputs.sha_short <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Creating a software module</em></p>\n<p>Then we can upload the binary to the software module.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Upload Artifact\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cgrotz/hawkbit<span class=\"token punctuation\">-</span>upload<span class=\"token punctuation\">-</span>artifact<span class=\"token punctuation\">-</span>action@v2\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">file-path</span><span class=\"token punctuation\">:</span> .pio/build/m5stack<span class=\"token punctuation\">-</span>core<span class=\"token punctuation\">-</span>esp32/firmware.bin\n        <span class=\"token key atrule\">software-module-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.create_sm.outputs.software<span class=\"token punctuation\">-</span>module<span class=\"token punctuation\">-</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-tenant</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_TENANT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Uploading the firmware binary to the software module. Please be mindful of the path, this might be different if the environment in the platform.ini is named differently.</em></p>\n<p>Now we create a distribution set and assign the software module to it. This can be done in one step using IoT Rollouts.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_ds\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Create Distribution Set\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cgrotz/hawkbit<span class=\"token punctuation\">-</span>create<span class=\"token punctuation\">-</span>distribution<span class=\"token punctuation\">-</span>set<span class=\"token punctuation\">-</span>action@v5\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">hawkbit-tenant</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_TENANT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">distribution-set-name</span><span class=\"token punctuation\">:</span> Beta Firmware\n        <span class=\"token key atrule\">distribution-set-type</span><span class=\"token punctuation\">:</span> app\n        <span class=\"token key atrule\">distribution-set-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.vars.outputs.sha_short <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">software-module-ids</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.create_sm.outputs.software<span class=\"token punctuation\">-</span>module<span class=\"token punctuation\">-</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Creating a new distribution set with the software moduel pre assigned</em></p>\n<p>Lastly we are assigning the distribution set to the target filter.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Assign distribution set to target filter\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cgrotz/hawkbit<span class=\"token punctuation\">-</span>assign<span class=\"token punctuation\">-</span>ds<span class=\"token punctuation\">-</span>to<span class=\"token punctuation\">-</span>target<span class=\"token punctuation\">-</span>filter<span class=\"token punctuation\">-</span>action@v8\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">hawkbit-tenant</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_TENANT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">target-filter-name</span><span class=\"token punctuation\">:</span> Beta Filter\n        <span class=\"token key atrule\">target-filter-type</span><span class=\"token punctuation\">:</span> forced\n        <span class=\"token key atrule\">target-filter-weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span>\n        <span class=\"token key atrule\">distribution-set-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.create_ds.outputs.distribution<span class=\"token punctuation\">-</span>set<span class=\"token punctuation\">-</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Assigning the distribution set to our target filter</em></p>\n<p>You also need to setup the credentials for IoT Rollouts in GitHub. I used the build in screts mechanism of GitHub for this.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/67c29a787042700853c7a0ad6332352c/d2782/github_actions_result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyUlEQVQoz5VS0Q6DIAzk//9rj/uK7QEUFQR0UPBWjDPbwxJscmlpmuu1RfgIuPCCtQbOe/YzZufgQ8C2bc2gnJEZYn4BcrBQSkFKha7robWGsRZXrJSCzBBpDXCjxrqsmIxBSuksalVXiXIueyxu8o7H8ITuNMZpQliWvVsrWbUYE69oQWQxQo09BjOdsq/s7Yf48CIngvEJ0hJGT3uyVJTDf+Lv95Hbx+VDBF4XxYjCXMLzZftes1ziQvwdq3WnonYgoqYv0UL4BivvdgluFrlGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github actions result\"\n        title=\"github actions result\"\n        src=\"/static/67c29a787042700853c7a0ad6332352c/fcda8/github_actions_result.png\"\n        srcset=\"/static/67c29a787042700853c7a0ad6332352c/12f09/github_actions_result.png 148w,\n/static/67c29a787042700853c7a0ad6332352c/e4a3f/github_actions_result.png 295w,\n/static/67c29a787042700853c7a0ad6332352c/fcda8/github_actions_result.png 590w,\n/static/67c29a787042700853c7a0ad6332352c/efc66/github_actions_result.png 885w,\n/static/67c29a787042700853c7a0ad6332352c/c83ae/github_actions_result.png 1180w,\n/static/67c29a787042700853c7a0ad6332352c/d2782/github_actions_result.png 1864w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<em>The setup secrets in GitHub Actions</em></p>\n<h2>Complete example build pipeline</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>push<span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Extract git commit id\n      <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> vars\n      <span class=\"token key atrule\">shell</span><span class=\"token punctuation\">:</span> bash\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        echo \"##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})\"\n        echo \"::set-output name=sha_short::$(git rev-parse --short HEAD)\"</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Python\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>python@v1\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install dependencies\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        python -m pip install --upgrade pip\n        pip install platformio</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run PlatformIO\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> platformio run\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Attach artifact\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/upload<span class=\"token punctuation\">-</span>artifact@v2\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> firmware_esp32\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> .pio/build/m5stack<span class=\"token punctuation\">-</span>core<span class=\"token punctuation\">-</span>esp32/firmware.bin\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_sm\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Create Software Module\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cgrotz/hawkbit<span class=\"token punctuation\">-</span>create<span class=\"token punctuation\">-</span>software<span class=\"token punctuation\">-</span>module<span class=\"token punctuation\">-</span>action@v4\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">hawkbit-tenant</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_TENANT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">software-module-name</span><span class=\"token punctuation\">:</span> Beta Firmware\n        <span class=\"token key atrule\">software-module-type</span><span class=\"token punctuation\">:</span> Application\n        <span class=\"token key atrule\">software-module-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.vars.outputs.sha_short <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Upload Artifact\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cgrotz/hawkbit<span class=\"token punctuation\">-</span>upload<span class=\"token punctuation\">-</span>artifact<span class=\"token punctuation\">-</span>action@v2\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">file-path</span><span class=\"token punctuation\">:</span> .pio/build/m5stack<span class=\"token punctuation\">-</span>core<span class=\"token punctuation\">-</span>esp32/firmware.bin\n        <span class=\"token key atrule\">software-module-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.create_sm.outputs.software<span class=\"token punctuation\">-</span>module<span class=\"token punctuation\">-</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-tenant</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_TENANT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> create_ds\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Create Distribution Set\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cgrotz/hawkbit<span class=\"token punctuation\">-</span>create<span class=\"token punctuation\">-</span>distribution<span class=\"token punctuation\">-</span>set<span class=\"token punctuation\">-</span>action@v5\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">hawkbit-tenant</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_TENANT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">distribution-set-name</span><span class=\"token punctuation\">:</span> Beta Firmware\n        <span class=\"token key atrule\">distribution-set-type</span><span class=\"token punctuation\">:</span> app\n        <span class=\"token key atrule\">distribution-set-version</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.vars.outputs.sha_short <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">software-module-ids</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.create_sm.outputs.software<span class=\"token punctuation\">-</span>module<span class=\"token punctuation\">-</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Assign distribution set to target filter\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cgrotz/hawkbit<span class=\"token punctuation\">-</span>assign<span class=\"token punctuation\">-</span>ds<span class=\"token punctuation\">-</span>to<span class=\"token punctuation\">-</span>target<span class=\"token punctuation\">-</span>filter<span class=\"token punctuation\">-</span>action@v8\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">hawkbit-tenant</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_TENANT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">hawkbit-password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ROLLOUTS_PASSWORD <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">target-filter-name</span><span class=\"token punctuation\">:</span> Beta Filter\n        <span class=\"token key atrule\">target-filter-type</span><span class=\"token punctuation\">:</span> forced\n        <span class=\"token key atrule\">target-filter-weight</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span>\n        <span class=\"token key atrule\">distribution-set-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.create_ds.outputs.distribution<span class=\"token punctuation\">-</span>set<span class=\"token punctuation\">-</span>id <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can go ahead with <a href=\"/2020-08-31-esp32_ci_cd_part5\">Part 5 - Connecting the ESP32 to the Bosch IoT Suite</a></p>","frontmatter":{"title":"Uploading the firmware to Bosch IoT Rollouts","date":"August 26, 2020","description":"In this part of the series we are going to connect our firmware build to Bosch IoT Rollouts."}}},"pageContext":{"slug":"/2020-08-26-esp32_ci_cd_part4/","previous":{"fields":{"slug":"/2020-08-25-esp32_ci_cd_part3/"},"frontmatter":{"title":"Preparing the Bosch IoT Suite"}},"next":{"fields":{"slug":"/2020-08-31-esp32_ci_cd_part5/"},"frontmatter":{"title":"Connecting the ESP32 to the Bosch IoT Suite"}}}},"staticQueryHashes":["1246554614","2841359383"]}