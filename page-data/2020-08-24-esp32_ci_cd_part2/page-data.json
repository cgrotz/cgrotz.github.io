{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-08-24-esp32_ci_cd_part2/","result":{"data":{"site":{"siteMetadata":{"title":"Christoph's Blog about Digital Stuff"}},"markdownRemark":{"id":"7b2604ff-9fdf-5c0e-932d-baa542259458","excerpt":"This is the second part of a multi-part blog post. You might want to start from the beginning with the first post. Let’s start by setting up a Platform.IO…","html":"<p>This is the second part of a multi-part blog post. You might want to start from the beginning with the <a href=\"/2020-08-23-esp32_ci_cd_part1\">first post</a>.</p>\n<p>Let’s start by setting up a Platform.IO project for GitHub Actions, just create a new project in Platform.IO. Select the board you are developing against, in my case I selected the M5 Stack option.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b90e2c536bf741d783429e4acbb80aa/e72de/create_new_project.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.37837837837837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4klEQVQ4y5VUSXLbMBDkN1KVVMoSwQXgJnGVRFP0ybnlmGvyhdzyhlzzmbyuMz0s0LIdeTk0BxgAPY2ZAYMkSTEMB7RtpzbLcmy3IYyJ/oswNFf8EeI4QcBP0zTY72uxLax16yFaj0uyS/9lACU0xiCKYnXQ0kmkqX0E3oTWrzEw4X1cJ0eQJAlOp5Ned5omHA5HHI8n8Y04n2fxnXF7O+mc+2jneda1eb5T0MeUUW3AD5Uxd85laquqQlGUCufcCmutrGc6XlTa9QzHVKmELEJdNyjLSnK5R9f1onhA3/dKwAN5vuBy7Ofck+eFkgdPE84oRBQtuWSeOPe5fQ2BrxRVsdK73U7yeEAtY8578VOJ0dRI4cxz+IKyHuuVN5vt0kuJRRSLokSUpU7tm6B7LQKSNVKhcRxR7RvsOqn0OMOVNWJbIHElYsK+jMRVSItWGluk+j5cmlPUpRlMbFdEhKh4GZki8Mls6hplPSAf7pE5u7ZOKbDSImEYvglKSIVFIWXP5HA5CEGqLbC8hkwDMr+heYyHtyw3lK4ggmXzUphQsXn2Vq//EIwGMnLm5tMHbD5/5Fv2ZfeR4qt/mqdk2p9mi7T7gun7b7Rffz704XtAQt5ICcMbuOkb7n/9xfHHH/wDP93ebk/FhnYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create new project\"\n        title=\"create new project\"\n        src=\"/static/2b90e2c536bf741d783429e4acbb80aa/fcda8/create_new_project.png\"\n        srcset=\"/static/2b90e2c536bf741d783429e4acbb80aa/12f09/create_new_project.png 148w,\n/static/2b90e2c536bf741d783429e4acbb80aa/e4a3f/create_new_project.png 295w,\n/static/2b90e2c536bf741d783429e4acbb80aa/fcda8/create_new_project.png 590w,\n/static/2b90e2c536bf741d783429e4acbb80aa/efc66/create_new_project.png 885w,\n/static/2b90e2c536bf741d783429e4acbb80aa/c83ae/create_new_project.png 1180w,\n/static/2b90e2c536bf741d783429e4acbb80aa/e72de/create_new_project.png 1198w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<em>Platform.IOs create new project dialog</em></p>\n<p>After the creation your project structure should look similar to what you can see on the following screenshot.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 454px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4cedd15ad81057a1893c111a3f53348f/b3c1d/project_layout_after_creation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.40540540540542%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAACZklEQVQ4y52USXPaQBCFfc8vSIolCKFlpJEQiyT2TewIMK7YuMwpleWaVOWcS2455C+/9AzBhV0EZB8aCUq8+fT6dV+ZJgO3LXzaDjBoh+j1IlQqVXQ6Xbrvo1r1MRhEj99tmyOfV1EoaCfrymQWCTL8/HYDPyhjEI3g+74UmM3maDZbUmi5XGE8nsCy7POChUIBJuPghokv0zo0TZN/FCTpdAaqWkA2+15WJpN9FBO/nxTUNB2GaaFWtPBjUYbnuhiN9iRCUAiIZ8TDh+v/xPaE9BC3LJjlBjKr72C8iO4/v9bra5RKZShK/qLQE0JGr2s4FaSGH2HYLtqtFsJaHe12B65bPOvZSUHbdlD2PGyvY9TrDUTREP1+H9PpDIya9mJBwzBgcwfTeQzPK1GXA7SIstvtvUZQk4TNoISvmwF67S6GozFSqbTs7KWuniTUdQNFx8W8E8ElUo8aIQSSdPVElzV4joecp+NN/A5BLcRkMoWYoJcIPSE0dRMK0/A2zIBzLjv7nCz5K9OHVfQQqRp+08SIUftwe4taWEMup7xCkAhVqgpjiAMfOmVSLAeDriLQQugglijYuq4jraiYeBy/hjVY1JT77T3u7rZYrdbYbG7ktBzTXiTM08kuM9D3HVi0FIIglGtLeOlQ90UWk1JKQoUIK0T4sO7BJT/FDC8WMebzBeI4lnOd1M+9h3TDSDiwTMqkKanExIgq0gEiQsLTRIQGhTqdU7FoePjzeYp6q4vdbic9FITCwzheyuLk72HznFmw4lQNBgWcm2I3Mkl0mKDjSkR4bLaS30dEzO8hLs/rkuhfSCN8X1fHkeQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"project layout after creation\"\n        title=\"project layout after creation\"\n        src=\"/static/4cedd15ad81057a1893c111a3f53348f/b3c1d/project_layout_after_creation.png\"\n        srcset=\"/static/4cedd15ad81057a1893c111a3f53348f/12f09/project_layout_after_creation.png 148w,\n/static/4cedd15ad81057a1893c111a3f53348f/e4a3f/project_layout_after_creation.png 295w,\n/static/4cedd15ad81057a1893c111a3f53348f/b3c1d/project_layout_after_creation.png 454w\"\n        sizes=\"(max-width: 454px) 100vw, 454px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<em>The project layout after creation</em></p>\n<p>Your platfomio.ini should look similar to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token selector\">[env:m5stack-core-esp32]</span>\n<span class=\"token constant\">platform</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> espressif32</span>\n<span class=\"token constant\">board</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> m5stack-core-esp32</span>\n<span class=\"token constant\">framework</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> arduino</span></code></pre></div>\n<p><em>Platform.IO configuration file</em></p>\n<p>The key thing you need to look for, is the name of the environment in the above example <em>m5stack-core-esp32</em>. The firmware binary will be placed in a folder with this name later on, therefore we will need this information in order to reference the file in the build.</p>\n<p>Create a GitHub Action workflow yml file in the <em>.github/workflows/</em> folder (you might need to create the folder). </p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>push<span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Python\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>python@v1\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install dependencies\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        python -m pip install --upgrade pip\n        pip install platformio</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run PlatformIO\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> platformio run\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Attach artifact\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/upload<span class=\"token punctuation\">-</span>artifact@v2\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> firmware_esp32\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> .pio/build/m5stack<span class=\"token punctuation\">-</span>core<span class=\"token punctuation\">-</span>esp32/firmware.bin</code></pre></div>\n<p><em>.github/workflows/ci.yml</em></p>\n<p>The result of each job execution will be attached to build pipeline. You can then download the result in the GitHub actions page.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/67c29a787042700853c7a0ad6332352c/d2782/github_actions_result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyUlEQVQoz5VS0Q6DIAzk//9rj/uK7QEUFQR0UPBWjDPbwxJscmlpmuu1RfgIuPCCtQbOe/YzZufgQ8C2bc2gnJEZYn4BcrBQSkFKha7robWGsRZXrJSCzBBpDXCjxrqsmIxBSuksalVXiXIueyxu8o7H8ITuNMZpQliWvVsrWbUYE69oQWQxQo09BjOdsq/s7Yf48CIngvEJ0hJGT3uyVJTDf+Lv95Hbx+VDBF4XxYjCXMLzZftes1ziQvwdq3WnonYgoqYv0UL4BivvdgluFrlGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github actions result\"\n        title=\"github actions result\"\n        src=\"/static/67c29a787042700853c7a0ad6332352c/fcda8/github_actions_result.png\"\n        srcset=\"/static/67c29a787042700853c7a0ad6332352c/12f09/github_actions_result.png 148w,\n/static/67c29a787042700853c7a0ad6332352c/e4a3f/github_actions_result.png 295w,\n/static/67c29a787042700853c7a0ad6332352c/fcda8/github_actions_result.png 590w,\n/static/67c29a787042700853c7a0ad6332352c/efc66/github_actions_result.png 885w,\n/static/67c29a787042700853c7a0ad6332352c/c83ae/github_actions_result.png 1180w,\n/static/67c29a787042700853c7a0ad6332352c/d2782/github_actions_result.png 1864w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<em>The resulting artifact in the GitHub Actions job run</em></p>\n<p>You can find the complete example with build here: <a href=\"https://github.com/cgrotz/esp32-platformio-example\">Link</a></p>\n<p>In the next post I am going to guide you through preparing everything in the Bosch IoT Suite for distributing the firmware updates. <a href=\"/2020-08-25-esp32_ci_cd_part3\">Part 3 - Preparing the Bosch IoT Suite</a></p>","frontmatter":{"title":"Building ESP32 firmware using Platfom.IO and GitHub Actions","date":"August 24, 2020","description":"Let's start by setting up a Platform.IO project for GitHub Actions, just create a new project in Platform.IO. Select the board you are developing against, in my case I selected the M5 Stack option."}}},"pageContext":{"slug":"/2020-08-24-esp32_ci_cd_part2/","previous":{"fields":{"slug":"/2020-08-23-esp32_ci_cd_part1/"},"frontmatter":{"title":"Getting started with CI/CD for ESP32 using GitHub Actions, Platform.IO and Bosch IoT Suite"}},"next":{"fields":{"slug":"/2020-08-25-esp32_ci_cd_part3/"},"frontmatter":{"title":"Preparing the Bosch IoT Suite"}}}},"staticQueryHashes":["1246554614","2841359383"]}