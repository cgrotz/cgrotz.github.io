{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018-01-14-using-rtos-tasks-on-esp32-under-arduino/","result":{"data":{"site":{"siteMetadata":{"title":"Christoph's Blog about Digital Stuff"}},"markdownRemark":{"id":"e70ce2db-89a0-577c-a840-a87b1e94f8eb","excerpt":"Today I got my first set of ESP 32 boards from AliExpress, and they are a beauty. If you don’t know the ESP32 yet, it’s the successor of the ESP8266 from…","html":"<p>Today I got my first set of ESP 32 boards from AliExpress, and they are a beauty. If you don’t know the ESP32 yet, it’s the successor of the ESP8266 from Espressif Systems which is a love child of the IoT prototyping community.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/344b1abea81730892435eb5fef26f916/6533e/esp32.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwEC/9oADAMBAAIQAxAAAAFQ1mJD22b/AP/EABsQAAIBBQAAAAAAAAAAAAAAAAEREgACAxAx/9oACAEBAAEFAhwt1JC/JLX/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAQESD/2gAIAQEABj8ChD//xAAaEAACAgMAAAAAAAAAAAAAAAAAARExECHB/9oACAEBAAE/IUipebfBzJrD6Mf/2gAMAwEAAgADAAAAEDAf/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBEh/9oACAEDAQE/EKx//8QAFxEAAwEAAAAAAAAAAAAAAAAAARARIf/aAAgBAgEBPxDIV//EABoQAQEBAQEBAQAAAAAAAAAAAAERACExkdH/2gAIAQEAAT8Q6jhCkSAevudOZg+xqJcWIANL1/Mvd//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"esp32\"\n        title=\"esp32\"\n        src=\"/static/344b1abea81730892435eb5fef26f916/1c72d/esp32.jpg\"\n        srcset=\"/static/344b1abea81730892435eb5fef26f916/a80bd/esp32.jpg 148w,\n/static/344b1abea81730892435eb5fef26f916/1c91a/esp32.jpg 295w,\n/static/344b1abea81730892435eb5fef26f916/1c72d/esp32.jpg 590w,\n/static/344b1abea81730892435eb5fef26f916/a8a14/esp32.jpg 885w,\n/static/344b1abea81730892435eb5fef26f916/6533e/esp32.jpg 1160w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<em>My new ESP32 board from Widora with his older brother the ESP8266 based NodeMCU in the background</em></p>\n<p>My new ESP32 board from Widora with his older brother the ESP8266 based NodeMCU in the background\nThe specs are amazing, it seems Espressif took everything the community love about the ESP8266 and fixed many of disadvantages. The following table (content from wikipedia.org, compares them quite nicely)</p>\n<table>\n<thead>\n<tr>\n<th>Item</th>\n<th>ESP8266</th>\n<th>ESP32</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CPU</td>\n<td>32 Bit, 80Mhz, Single Core</td>\n<td>32 Bit, 160 or 240 MhZ, Dual Core</td>\n</tr>\n<tr>\n<td>Wifi</td>\n<td>802.11 b/g/n</td>\n<td>802.11 b/g/n</td>\n</tr>\n<tr>\n<td>Bluetooth</td>\n<td>–</td>\n<td>4.2 + BLE</td>\n</tr>\n<tr>\n<td>ADC</td>\n<td>10 Bit</td>\n<td> 12 Bit</td>\n</tr>\n<tr>\n<td>Peripherie</td>\n<td>16 GPIO pins, SPI, I²C (software implementation), I²S interfaces with DMA (sharing pins with GPIO), UART on dedicated pins, plus a transmit-only UART can be enabled on GPIO2</td>\n<td>12-bit SAR ADC up to 18 channels, 2 × 8-bit DACs, 10 × touch sensors (capacitive sensing GPIOs), Temperature sensor, 4 × SPI, 2 × I²S interfaces, 2 × I²C interfaces, 3 × UART, SD/SDIO/CE-ATA/MMC/eMMC host controller, SDIO/SPI slave controller, Ethernet MAC interface with dedicated DMA and IEEE 1588 Precision Time Protocol support, CAN bus 2.0, Infrared remote controller (TX/RX, up to 8 channels), Motor PWM, LED PWM (up to 16 channels), Hall effect sensor, Ultra low power analog pre-amplifier</td>\n</tr>\n<tr>\n<td>Other</td>\n<td></td>\n<td>Ultra low power (ULP) co-processor, Wakeup from Interrupt, Cryptographic hardware acceleration: AES, SHA-2, RSA, elliptic curve cryptography (ECC), random number generator (RNG)…</td>\n</tr>\n</tbody>\n</table>\n<p>The Espressif IoT Development Framework (Link) includes FreeRTOS, and you can conveniently use it from the Arduino ID. Simply create and delete FreeRTOS tasks using the well known commands.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  Serial<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token number\">115200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">xTaskCreate</span><span class=\"token punctuation\">(</span>readSensor<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ReadSensorTask\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">readSensor</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> parameter <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">char</span> buffer <span class=\"token punctuation\">[</span><span class=\"token number\">50</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">sprintf</span> <span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hello From Task %d\"</span><span class=\"token punctuation\">,</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      Serial<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The first parameter of the <a href=\"https://www.freertos.org/a00125.html\">xTaskCreate</a> function takes the pointer to the function that implements this task. The second parameter is the task name, the name can be used for debugging, but could also be used for retrieving a task handle. The third parameter is the stack size that should be allocated for this task, determining the stack size can be a challenging task <a href=\"https://www.freertos.org/FAQMem.html#StackSize.\">Link</a>. The fourth parameter is a value that is passed to the task as a parameter. The fifth task is the priority of the task. The sixth parameter can be passed in to obtain a handle on the task directly.</p>\n<p>With this simple setup, you can have a separate task running in the background reading for example the ADC and posting the result to a BLE characteristic. Isn’t that cool?</p>","frontmatter":{"title":"Using RTOS tasks on ESP32 under Arduino","date":"January 14, 2018","description":null}}},"pageContext":{"slug":"/2018-01-14-using-rtos-tasks-on-esp32-under-arduino/","previous":{"fields":{"slug":"/2017-04-09-how-to-run-a-trained-tensorflow-model-on-cloud-foundry/"},"frontmatter":{"title":"How to run a trained Tensorflow model on Cloud Foundry"}},"next":{"fields":{"slug":"/maven/"},"frontmatter":{"title":"Apache Maven"}}}},"staticQueryHashes":["1246554614","2841359383"]}